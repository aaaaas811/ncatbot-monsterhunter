# MH 插件

怪物猎人相关功能的QQ机器人插件，支持集会码管理、怪物数据查询等功能。

## 功能特性

### 集会码管理
- **自动记录**：发送MHW或MHR集会码自动记录
- **查询列表**：查看所有记录的集会码
- **删除功能**：删除最近的集会码
- **清空功能**：清空所有集会码

### 怪物数据查询（支持多个数据源）
- **怪物列表**：列出所有收录的怪物名称（支持 `mhws` / `mhwi` 数据源）
- **怪物简介**：查询怪物的基本信息、图片、简介等
- **弱点分析**：分析怪物的弱点，提供物理和属性攻击建议
- **肉质表**：显示怪物的肉质数据和状态分析（支持数据源选择）

### 数据更新
- **自动爬取**：从网络获取最新的怪物数据
- **数据存储**：数据保存在本地，支持离线查询

## 使用方法

### 集会码相关命令
- 发送12位MHW集会码或8位MHR集会码自动记录
- `/查询` - 查看所有集会码列表
- `/删除mhw` - 删除最近的MHW集会码
- `/删除mhr` - 删除最近的MHR集会码
- `/清空` - 清空所有集会码

### 怪物查询命令（支持数据源选择，wi为默认行为）
- `/怪物列表` - 显示所有怪物名称
- `/ws简介 [怪物名字]` - 使用 `mhws` 数据查询怪物基本信息
- `/wi简介 [怪物名字]` - 使用 `mhwi` 数据查询怪物基本信息
- `/ws弱点 [怪物名字]` - 使用 `mhws` 数据查看怪物弱点分析
- `/wi弱点 [怪物名字]` - 使用 `mhws` 数据查看怪物弱点分析
- `/ws肉质 [怪物名字]` - 使用 `mhws` 数据源显示肉质表
- `/wi肉质 [怪物名字]` - 使用 `mhwi` 数据源显示肉质表

### 管理命令
- `/helpMH` - 显示帮助信息
- `/爬取ws` - 更新 `mhws` 数据（需要网络连接）
- `/爬取wi` - 更新 `mhwi` 数据（需要网络连接）

## 安装依赖

插件需要以下Python包，请在插件目录下运行：

```bash
pip install -r requirements.txt
```

依赖包列表：
- requests==2.31.0
- beautifulsoup4==4.12.2
- aiohttp>=3.9.1

## 数据存储

- 集会码数据存储在内存中，重启后丢失
- 怪物数据存储在插件的 `data/` 子文件夹中：
  - `plugins/mh/data/mhws/`（mhws 源）
  - `plugins/mh/data/mhwi/`（mhwi 源）
- 使用 `.gitignore` 忽略数据文件夹，避免提交到版本控制

### 注意事项
1. 怪物数据查询功能支持来自多个站点的数据源（`mhws` 与 `mhwi`），命令可指定数据源以获得不同来源的数据。
2. `mhwi` 与 `mhws` 在页面结构上存在差异；插件内已实现对 `mhwi` 格式的归一化处理，但个别怪物可能仍需验证。
3. 爬取数据功能需要网络连接，可能需要较长时间；首次使用可分别运行 `/爬取ws` 与 `/爬取wi` 更新两套数据。
4. 初始化以及版本更新时，建议运行爬取命令更新数据。
5. 集会码格式会自动验证，无效格式不会记录.

## 技术架构

- 主文件：`mh.py` - 插件入口和消息处理
- 分析模块：`analyze.py` - 怪物数据分析逻辑
- 爬虫模块：`mhwi_Wiki_Crawler/``mhws_Wiki_Crawler/` - 数据爬取工具
- 数据存储：`data/` - JSON格式的怪物数据

## 更新计划

- 素材掉落分析：添加怪物素材掉落概率和条件分析功能
- MHW/MHR数据支持：开发MHW和MHR的专用爬虫，实现完整的数据爬取

## 更新日志

### v0.0.3
- 重构代码结构，将分析逻辑分离到独立模块
- 优化数据存储路径
- 添加.gitignore配置

### v0.0.2
- 添加怪物弱点分析功能
- 优化肉质表显示格式

### v0.0.1
- 基础集会码管理功能
- 怪物简介查询功能

## 鸣谢

感谢以下开源项目和贡献者：

- **mhws_Wiki_Crawler** - Wilds数据爬虫
  - Github: https://github.com/Azuxa616/mhws_Wiki_Crawler
  - Author: @Azuxa616
  - 提供了完整的怪物猎人Wilds怪物数据爬取功能

